import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                   */let i=parseInt(localStorage.getItem("puntosUsuario"))||123,p=JSON.parse(localStorage.getItem("productosFavoritos"))||[],d=!1,l=null,b=[{id:1,nombre:"10% Descuento Walmart",puntos:50,activo:!0,app:"Walmart"},{id:2,nombre:"5% Descuento EcoPuntos",puntos:20,activo:!0,app:"EcoPuntos"},{id:3,nombre:"15% Descuento Walmart",puntos:100,activo:!1,app:"Walmart"}];function s(t){if(t==null)return"0";const e=typeof t=="string"?parseFloat(t.replace(",",".")):t;if(isNaN(e))return"0";if(Number.isInteger(e))return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");const o=e.toString().split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),o.join(",")}function c(t,e=1){if(t==null)return"0";const o=typeof t=="string"?parseFloat(t.replace(",",".")):t;if(isNaN(o))return"0";const n=o.toFixed(e).split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),n.join(",")}function h(t){if(t==null)return"$0";const e=typeof t=="string"?parseFloat(t.replace(",",".")):t;if(isNaN(e))return"$0";if(Number.isInteger(e))return`$${e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}`;const o=e.toFixed(0).split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),`$${o[0]}`}document.addEventListener("DOMContentLoaded",function(){N(),D(),B(),fe()});function N(){f();const t=document.getElementById("formNotificaciones");t&&t.addEventListener("submit",C)}function D(){H(),document.addEventListener("keydown",t=>{t.key==="Escape"&&Ee()})}function H(){["modalNotificaciones","modalCupones","modalCanjear","modalLectorQR","modalCalculadoraHuella","modalHistorialEscaneos","modalEstadisticas","modalDetallesPedido","modalAyuda","modalMapaEcoPuntos","modalFavoritos"].forEach(e=>{const o=document.getElementById(e);o&&o.addEventListener("click",n=>{n.target===o&&ge(e)})})}function E(){const t=document.getElementById("userMenu"),e=document.querySelector('[aria-controls="userMenu"]');t.classList.toggle("hidden"),d=!d,e&&e.setAttribute("aria-expanded",d.toString()),d?setTimeout(()=>{document.addEventListener("click",g)},10):document.removeEventListener("click",g)}function g(t){const e=document.getElementById("userMenu"),o=document.querySelector('[aria-controls="userMenu"]');e&&o&&!e.contains(t.target)&&!o.contains(t.target)&&(e.classList.add("hidden"),d=!1,o&&o.setAttribute("aria-expanded","false"),document.removeEventListener("click",g))}function j(){d&&E(),setTimeout(()=>{document.getElementById("modalNotificaciones").classList.remove("hidden"),B()},150)}function I(){document.getElementById("modalNotificaciones").classList.add("hidden")}function B(){const t=JSON.parse(localStorage.getItem("notificaciones"))||{puntos:!0,promociones:!0,productos:!0,habitos:!0},e=document.getElementById("formNotificaciones");e&&(e.puntos.checked=t.puntos,e.promociones.checked=t.promociones,e.productos.checked=t.productos,e.habitos.checked=t.habitos)}function C(t){t.preventDefault();const e=new FormData(this),o={puntos:e.get("puntos")==="on",promociones:e.get("promociones")==="on",productos:e.get("productos")==="on",habitos:e.get("habitos")==="on"};localStorage.setItem("notificaciones",JSON.stringify(o)),a("‚úÖ Preferencias de notificaciones guardadas"),I()}function S(){document.getElementById("modalCupones").classList.remove("hidden"),x()}function L(){document.getElementById("modalCupones").classList.add("hidden")}function x(){const t=document.getElementById("listaCupones");t&&(t.innerHTML="",b.forEach(e=>{const o=i>=e.puntos&&e.activo;t.innerHTML+=`
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <div>
                    <div class="font-semibold">${e.nombre}</div>
                    <div class="text-xs text-gray-500">Requiere ${s(e.puntos)} puntos ‚Ä¢ ${e.app}</div>
                </div>
                <button ${o?"":"disabled"} 
                    class="px-3 py-1 rounded-lg text-white ${o?"bg-green-500 hover:bg-green-600":"bg-gray-300 cursor-not-allowed"}"
                    onclick="canjearCupon(${e.id})">
                    Canjear
                </button>
            </div>
        `}))}function $(t){const e=b.find(o=>o.id===t);if(!e||!e.activo){a("‚ùå Este cup√≥n ya no est√° disponible.","error");return}if(i<e.puntos){a("‚ùå No tienes puntos suficientes para canjear este cup√≥n.","error");return}i-=e.puntos,localStorage.setItem("puntosUsuario",i),a(`‚úÖ Cup√≥n canjeado: ${e.nombre} (${e.app})`),x(),f(),L()}function F(){document.getElementById("modalCanjear").classList.remove("hidden"),document.getElementById("puntosModal").textContent=s(i)}function k(){document.getElementById("modalCanjear").classList.add("hidden")}function A(t,e){if(i<t){a("‚ùå No tienes puntos suficientes para canjear este producto.","error");return}i-=t,localStorage.setItem("puntosUsuario",i),a(`‚úÖ Canjeado: ${e} por ${s(t)} puntos`),f(),document.getElementById("puntosModal").textContent=s(i)}function T(){document.getElementById("modalLectorQR").classList.remove("hidden"),document.getElementById("resultadoQR").classList.add("hidden"),document.getElementById("btnIniciarCamara").classList.remove("hidden"),document.getElementById("btnDetenerCamara").classList.add("hidden")}function R(){v(),document.getElementById("modalLectorQR").classList.add("hidden")}function U(){const t=document.getElementById("video"),e=document.getElementById("btnIniciarCamara"),o=document.getElementById("btnDetenerCamara"),n=document.getElementById("camaraContainer");navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(r){l=r,t.srcObject=l,t.play(),t.classList.remove("hidden"),n.querySelector(".bg-gray-100").classList.add("hidden"),e.classList.add("hidden"),o.classList.remove("hidden"),setTimeout(z,2e3)}).catch(function(r){console.error("Error al acceder a la c√°mara:",r),a("‚ùå No se pudo acceder a la c√°mara","error")}):a("‚ùå Tu dispositivo no soporta acceso a la c√°mara","error")}function v(){l&&(l.getTracks().forEach(o=>o.stop()),l=null),document.getElementById("video").classList.add("hidden"),document.getElementById("btnIniciarCamara").classList.remove("hidden"),document.getElementById("btnDetenerCamara").classList.add("hidden"),document.getElementById("camaraContainer").querySelector(".bg-gray-100").classList.remove("hidden")}function z(){const t=["Botella de Agua Reutilizable - 15 Puntos Verdes","Panel Solar Port√°til - 50 Puntos Verdes","Compuesto Org√°nico - 25 Puntos Verdes"],e=t[Math.floor(Math.random()*t.length)];document.getElementById("qrData").textContent=e,document.getElementById("resultadoQR").classList.remove("hidden");const o=parseInt(e.match(/(\d+)/)[0]);i+=o,localStorage.setItem("puntosUsuario",i),f(),a(`‚úÖ ${e}`,"success"),v()}function O(){document.getElementById("modalCalculadoraHuella").classList.remove("hidden"),document.getElementById("resultadoHuella").classList.add("hidden"),document.getElementById("transporteKm").value="",document.getElementById("consumoElectrico").value=""}function q(){document.getElementById("modalCalculadoraHuella").classList.add("hidden")}function Q(){const t=parseInt(document.getElementById("transporteKm").value)||0,e=parseInt(document.getElementById("consumoElectrico").value)||0,o=document.getElementById("tipoAlimentacion").value;let n=t*.2,r=e*.5,u=0;switch(o){case"vegetariano":u=100;break;case"vegano":u=80;break;default:u=150}const m=n+r+u,y=300;document.getElementById("huellaResultado").textContent=`${c(m,1)} kg CO‚ÇÇ/mes`;const w=Math.abs(m-y);m<y?document.getElementById("comparativaHuella").textContent=`¬°Excelente! Est√°s ${c(w,1)} kg por debajo del promedio nacional`:document.getElementById("comparativaHuella").textContent=`Est√°s ${c(w,1)} kg por encima del promedio nacional`;const P=Math.min(m/500*100,100);document.getElementById("barraProgreso").style.width=`${P}%`,document.getElementById("resultadoHuella").classList.remove("hidden"),a("üåç Huella de carbono calculada")}function V(){document.getElementById("modalHistorialEscaneos").classList.remove("hidden")}function J(){document.getElementById("modalHistorialEscaneos").classList.add("hidden")}function W(){a("üìÑ Historial exportado exitosamente")}function G(){document.getElementById("modalEstadisticas").classList.remove("hidden")}function X(){document.getElementById("modalEstadisticas").classList.add("hidden")}function K(){a("üìä Estad√≠sticas compartidas")}function Y(){document.getElementById("modalDetallesPedido").classList.remove("hidden")}function Z(){document.getElementById("modalDetallesPedido").classList.add("hidden")}function _(){a("üöö Redirigiendo a seguimiento de pedido")}function ee(){document.getElementById("modalAyuda").classList.remove("hidden")}function te(){document.getElementById("modalAyuda").classList.add("hidden")}function oe(){a("üìß Redirigiendo a formulario de contacto")}function ae(){document.getElementById("modalMapaEcoPuntos").classList.remove("hidden")}function ne(){document.getElementById("modalMapaEcoPuntos").classList.add("hidden")}function ie(){a("üìç Ubicaci√≥n actualizada")}function re(){document.getElementById("modalFavoritos").classList.remove("hidden"),M()}function se(){document.getElementById("modalFavoritos").classList.add("hidden")}function M(){const t=document.getElementById("listaFavoritos"),e=document.getElementById("favoritosVacio");if(t){if(p.length===0){t.classList.add("hidden"),e.classList.remove("hidden");return}t.classList.remove("hidden"),e.classList.add("hidden"),t.innerHTML=p.map(o=>`
        <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg border">
            <div class="flex items-center space-x-3">
                <i class="fas fa-heart text-red-500"></i>
                <div>
                    <div class="font-semibold text-gray-800">${o.nombre||"Producto"}</div>
                    <div class="text-xs text-gray-500">${h(o.precio||0)} - ${s(o.puntosVerdes||0)} Puntos</div>
                </div>
            </div>
            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs">
                Comprar
            </button>
        </div>
    `).join("")}}function de(){confirm("¬øEst√°s seguro de que quieres limpiar todos tus favoritos?")&&(p=[],localStorage.setItem("productosFavoritos",JSON.stringify(p)),a("üóëÔ∏è Favoritos limpiados"),M())}function ce(){window.location.href="../tienda/tienda.html"}function le(){a("üîÑ Sincronizando datos..."),setTimeout(()=>{a("‚úÖ Datos sincronizados correctamente")},2e3)}function ue(){a("üì∑ Abriendo esc√°ner de c√≥digos de barras")}function me(){a("üìä Generando reporte de impacto ambiental..."),setTimeout(()=>{a("‚úÖ Reporte exportado exitosamente")},1500)}function pe(){a("üì§ Compartiendo reporte de impacto...")}function fe(){const t=document.getElementById("carbonoEvitado");t&&(t.textContent=c(5.8));const e=document.getElementById("arbolesEquiv");e&&(e.textContent=c(.3,1)),[{id:"co2Evitado",valor:5.8},{id:"arbolesEquiv",valor:.26},{id:"productosEscaneados",valor:12},{id:"rankingEcologico",valor:47}].forEach(n=>{const r=document.getElementById(n.id);r&&(n.id==="rankingEcologico"?r.textContent=`${s(n.valor)}¬∞`:n.id==="productosEscaneados"?r.textContent=s(n.valor):r.textContent=c(n.valor,n.id==="arbolesEquiv"?2:1))})}function f(){["puntosDisplay","puntosModal","totalPuntos"].forEach(e=>{const o=document.getElementById(e);o&&(o.textContent=s(i))})}function a(t,e="success"){const o=document.createElement("div"),n=e==="success"?"bg-green-600":e==="error"?"bg-red-600":e==="warning"?"bg-yellow-600":"bg-blue-600";o.className=`fixed bottom-4 right-4 ${n} text-white px-6 py-3 rounded-xl shadow-lg z-[10000] transform transition-all duration-300`,o.innerText=t,o.style.transform="translateX(100%)",o.style.opacity="0",document.body.appendChild(o),setTimeout(()=>{o.style.transform="translateX(0)",o.style.opacity="1"},10),setTimeout(()=>{o.style.transform="translateX(100%)",o.style.opacity="0",setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)},4e3)}function ge(t){const e=document.getElementById(t);e&&e.classList.add("hidden")}function Ee(){document.querySelectorAll('[id^="modal"]').forEach(e=>{e.classList.add("hidden")}),d&&E()}window.toggleUserMenu=E;window.abrirNotificaciones=j;window.cerrarNotificaciones=I;window.guardarPreferencias=C;window.abrirCupones=S;window.cerrarCupones=L;window.canjearCupon=$;window.abrirModalCanjear=F;window.cerrarModalCanjear=k;window.canjearProducto=A;window.abrirLectorQR=T;window.cerrarLectorQR=R;window.iniciarCamara=U;window.detenerCamara=v;window.abrirCalculadoraHuella=O;window.cerrarCalculadoraHuella=q;window.calcularHuella=Q;window.abrirHistorialEscaneos=V;window.cerrarHistorialEscaneos=J;window.exportarHistorial=W;window.abrirEstadisticas=G;window.cerrarEstadisticas=X;window.compartirEstadisticas=K;window.mostrarDetallesPedido=Y;window.cerrarDetallesPedido=Z;window.seguirPedido=_;window.abrirAyuda=ee;window.cerrarAyuda=te;window.contactarSoporte=oe;window.abrirMapaEcoPuntos=ae;window.cerrarMapaEcoPuntos=ne;window.actualizarUbicacion=ie;window.abrirFavoritos=re;window.cerrarFavoritos=se;window.limpiarFavoritos=de;window.irATienda=ce;window.sincronizarDatos=le;window.abrirEscanerBarras=ue;window.exportarReporte=me;window.compartirReporte=pe;window.generarNotificacion=a;window.formatearNumero=s;window.formatearDecimal=c;window.formatearMoneda=h;
